{% extends 'base.html' %}

{% block title %}{{ recipe.title }} - CookBook{% endblock %}

{% block content %}
<div class="container recipe-detail">
    <div class="recipe-header">
        <h1>{{ recipe.title }}</h1>
        
        <div class="recipe-actions">
            {% if user.is_authenticated %}
            <a href="{% url 'toggle_favorite' recipe.id %}" class="favorite-btn {% if is_favorite %}active{% endif %}">
                ‚ù§Ô∏è {% if is_favorite %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º{% else %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}
            </a>
            {% endif %}
        </div>
    </div>
    
    {% if recipe.image %}
    <div class="recipe-hero-image">
        <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
    </div>
    {% endif %}
    
    <div class="recipe-meta-info">
        <div class="meta-item">
            <span class="cooking-time">‚è± {{ recipe.cooking_time }} –º–∏–Ω—É—Ç</span>
        </div>
        <div class="meta-item">
            <span class="views">üëÅÔ∏è {{ recipe.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
        </div>
        <div class="meta-item">
            <span class="rating">
                ‚≠ê {{ avg_rating|floatformat:1 }}/5 ({{ reviews.count }} –æ—Ç–∑—ã–≤–æ–≤)
            </span>
        </div>
        <div class="meta-item">
            <span class="categories">
                {% for category in recipe.categories.all %}
                <span class="category-tag">{{ category.name }}</span>
                {% endfor %}
            </span>
        </div>
    </div>
    
    <div class="recipe-content">
        <section class="description">
            <h2>üìù –û–ø–∏—Å–∞–Ω–∏–µ</h2>
            <p>{{ recipe.description }}</p>
        </section>

        <div class="recipe-columns">
            <section class="ingredients">
                <h2>üõí –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h2>
                <div class="ingredients-list">
                    {{ recipe.ingredients|linebreaks }}
                </div>
            </section>

            <section class="steps">
                <h2>üë®‚Äçüç≥ –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ</h2>
                <div class="steps-list">
                    {{ recipe.cooking_steps|linebreaks }}
                </div>
            </section>
        </div>
    </div>

    <!-- –û—Ç–∑—ã–≤—ã -->
    <section class="reviews">
        <h2>üí¨ –û—Ç–∑—ã–≤—ã ({{ reviews.count }})</h2>
        
        {% if user.is_authenticated %}
        <div class="review-form">
            <h3>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
            <form method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label>–û—Ü–µ–Ω–∫–∞:</label>
                    {{ form.rating }}
                </div>
                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                    {{ form.comment }}
                </div>
                <button type="submit" class="btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
            </form>
        </div>
        {% else %}
        <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</p>
        {% endif %}
        
        <div class="reviews-list">
            {% for review in reviews %}
            <div class="review-item">
                <div class="review-header">
                    <strong>{{ review.user.username }}</strong>
                    <span class="review-rating">‚≠ê {{ review.rating }}/5</span>
                    <span class="review-date">{{ review.created_at|date:"d.m.Y H:i" }}</span>
                </div>
                {% if review.comment %}
                <div class="review-comment">
                    {{ review.comment }}
                </div>
                {% endif %}
            </div>
            {% empty %}
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            {% endfor %}
        </div>
    </section>
    
    <div class="navigation">
        <a href="{% url 'recipe_list' %}" class="btn-primary">‚Üê –í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã</a>
    </div>
</div>
{% endblock %}